<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Today_todo App</title> <script src="https://unpkg.com/dexie@3.2.3/dist/dexie.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <style>
        /* ğŸ¨ ë””ìì¸ ë°˜ì˜ CSS */
        :root {
            --primary-color: #ff8c94; 
            --primary-dark: #e91e63; 
            --accent-color: #9c27b0; 
            --green-success: #4caf50; 
            --danger-color: #f44336;
            --background-color: #fce4ec; 
            --card-background: #ffffff;
            --text-color: #333333;
            --shadow-light: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .container {
            width: 100%;
            max-width: 400px; 
            background: var(--background-color);
        }

        .card {
            background-color: var(--card-background); 
            padding: 20px; 
            border-radius: 20px; 
            box-shadow: var(--shadow-light); 
            margin-bottom: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        h2 {
            text-align: center;
            color: var(--primary-dark);
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .input-group input {
            flex-grow: 1;
            padding: 12px;
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            font-size: 1em;
            outline: none;
        }
        .input-group button {
            background-color: var(--green-success);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }

        .task { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 0; 
            border-bottom: 1px solid #f0f0f0; 
            cursor: pointer;
        }
        .task:last-child { border-bottom: none; }
        .task-content { 
            flex-grow: 1; 
            display: flex; 
            align-items: center; 
            font-size: 1.1em;
        }
        
        .checkbox { 
            margin-right: 15px; 
            font-size: 1.2em; 
            color: #ccc; 
            min-width: 20px;
            text-align: center;
        } 
        .task.done .checkbox { 
            color: var(--green-success); 
        } 
        .task.done .task-content { 
            text-decoration: line-through; 
            color: #999; 
        }
        .delete-btn { 
            background: none; 
            border: none; 
            color: var(--danger-color); 
            cursor: pointer; 
            font-size: 1.2em;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        .task-points { 
            font-size: 0.8em; 
            margin-left: 10px; 
            color: var(--accent-color); 
            font-weight: bold;
        }

        .score-info {
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            color: var(--text-color);
            padding: 10px 0;
            margin-bottom: 10px;
        }
        .reset-btn {
            background-color: var(--primary-dark);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .reset-btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Today_todo ğŸ</h2> <div class="card" style="background-color: #f8bbd0; color: white;">
            <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 5px;" id="currentDate">
                </div>
            <div style="font-size: 0.9em; opacity: 0.8;">
                </div>
        </div>

        <div class="card input-card">
            <div class="input-group">
                <input type="text" id="newTask" placeholder="Enter a new task...">
                <button id="addTaskBtn">Add</button>
            </div>

            <div class="score-info" id="todayScore">
                Today's Score: 0 / 0 points
            </div>
            <div class="score-info" id="todayGrade" style="font-size: 1em; color: var(--accent-color);">
                Grade: F
            </div>
        </div>

        <div id="taskList" class="card list-card" style="padding: 10px 20px;">
            <div class="empty-message">í•  ì¼ì„ ì¶”ê°€í•´ ë³´ì„¸ìš”!</div>
        </div>

        <button id="resetManualBtn" class="reset-btn">
            <i class="fas fa-undo"></i> í• ì¼ì´ˆê¸°í™”
        </button>
    </div>

<script>
// =========================================================================
// ğŸ§© JavaScript ë¡œì§ (TODO ì „ìš©)
// =========================================================================

const db = new Dexie('TodoAppDB');
db.version(1).stores({
    tasks_db: 'id, date, todo, done, points', 
});

// --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

function getTodayKey() {
    return new Date().toISOString().split('T')[0]; 
}

function calculateGrade(achieved, total) {
    if (total === 0) return 'F ğŸ˜­';
    const ratio = achieved / total;
    
    if (ratio >= 1.0) return 'A+ âœ…'; // 100%
    if (ratio >= 0.8) return 'A ğŸŒŸ';  // 80%
    if (ratio >= 0.6) return 'B ğŸ‘';  // 60%
    if (ratio >= 0.4) return 'C ğŸ™‚';  // 40%
    if (ratio >= 0.2) return 'D ğŸ˜';  // 20%
    return 'F ğŸ˜­';                    // Below 20%
}

function showToast(message, type = 'info') {
    console.log(`[Toast - ${type}] ${message}`);
}

function updateDateTime() {
    const now = new Date();
    const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
    
    document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);
    document.getElementById('currentDate').nextElementSibling.textContent = now.toLocaleTimeString('en-US', timeOptions); 
}


// --- TODO í•µì‹¬ ë¡œì§ ---

async function addTask() {
    const newTaskInput = document.getElementById('newTask');
    const todoText = newTaskInput.value.trim();

    if (todoText === '') {
        alert('í•  ì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        return;
    }

    const todayKey = getTodayKey();
    
    try {
        await db.tasks_db.add({
            date: todayKey,
            todo: todoText,
            done: false,
            points: 20, 
            id: Date.now() 
        });
        newTaskInput.value = '';
        renderTodoList();
        showToast('í•  ì¼ ì¶”ê°€ ì™„ë£Œ!', 'success');
    } catch (error) {
        showToast('í•  ì¼ ì¶”ê°€ ì˜¤ë¥˜: ' + error, 'error');
        console.error("Add Task Error:", error);
    }
}

async function renderTodoList() {
    const todayKey = getTodayKey();
    const tasks = await db.tasks_db.where({ date: todayKey }).toArray();
    
    const totalPoints = tasks.reduce((sum, task) => sum + task.points, 0);
    const achievedPoints = tasks.filter(t => t.done).reduce((sum, task) => sum + task.points, 0);
    
    document.getElementById('todayScore').textContent = `Today's Score: ${achievedPoints} / ${totalPoints} points`;
    document.getElementById('todayGrade').textContent = `Grade: ${calculateGrade(achievedPoints, totalPoints)}`;

    const taskListElement = document.getElementById('taskList');
    taskListElement.innerHTML = '';
    
    if (tasks.length === 0) {
        taskListElement.innerHTML = '<div class="empty-message">ì˜¤ëŠ˜ì˜ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê³  ì ìˆ˜ë¥¼ íšë“í•˜ì„¸ìš”.</div>';
        return;
    }

    tasks.forEach(task => {
        const taskElement = document.createElement('div');
        taskElement.className = `task ${task.done ? 'done' : ''}`;
        
        const checkboxIcon = task.done ? 'âœ”ï¸' : 'â—»ï¸';
        
        taskElement.innerHTML = `
            <div class="task-content" onclick="toggleTaskDone(${task.id}, ${!task.done})">
                <span class="checkbox">${checkboxIcon}</span>
                ${task.todo}
                <span class="task-points">${task.points}P</span>
            </div>
            <button class="delete-btn" onclick="event.stopPropagation(); deleteTask(${task.id})">âŒ</button>
        `;
        taskListElement.appendChild(taskElement);
    });
}

async function toggleTaskDone(id, done) {
    try {
        await db.tasks_db.update(id, { done: done });
        renderTodoList();
        showToast(done ? 'í•  ì¼ ì™„ë£Œ! ğŸ‰' : 'ë‹¤ì‹œ ë¯¸ì™„ë£Œ', 'info');
    } catch (error) {
        showToast('ì—…ë°ì´íŠ¸ ì˜¤ë¥˜: ' + error, 'error');
    }
}

async function deleteTask(id) {
    if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì´ í•  ì¼ë§Œ ì‚­ì œë©ë‹ˆë‹¤)')) {
        try {
            await db.tasks_db.delete(id);
            renderTodoList();
            showToast('í•  ì¼ ì‚­ì œ ì™„ë£Œ', 'success');
        } catch (error) {
            showToast('ì‚­ì œ ì˜¤ë¥˜: ' + error, 'error');
        }
    }
}

// ** ìˆ˜ë™ ì´ˆê¸°í™” ê¸°ëŠ¥ (ë²„íŠ¼ëª…: í• ì¼ì´ˆê¸°í™”, ê¸°ëŠ¥: í•­ëª© ì „ì²´ ì‚­ì œ) **
async function resetTasksPermanently() {
    // ê²½ê³  ë©”ì‹œì§€ë¥¼ ëª…í™•íˆ í•˜ì—¬, 'ì´ˆê¸°í™”' ë²„íŠ¼ì´ì§€ë§Œ ì‹¤ì œë¡œëŠ” í•­ëª© 'ì‚­ì œ'ì„ì„ ì•Œë¦½ë‹ˆë‹¤.
    if (confirm('âš ï¸ ê²½ê³ : [í• ì¼ì´ˆê¸°í™”] ë²„íŠ¼ì€ ì˜¤ëŠ˜ í•  ì¼ ëª©ë¡ì„ ë°ì´í„°ì—ì„œ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤. ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const todayKey = getTodayKey();
        try {
            // Dexieì˜ delete()ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¤ëŠ˜ ë‚ ì§œì˜ ëª¨ë“  í•  ì¼ í•­ëª©ì„ ì‚­ì œ
            const deleteCount = await db.tasks_db
                .where({ date: todayKey })
                .delete();
            
            if (deleteCount > 0) {
                 renderTodoList();
                 showToast('ëª¨ë“  í•  ì¼ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                 showToast('ì‚­ì œí•  í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
            }
        } catch (error) {
            showToast('âš ï¸ ì‚­ì œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
            console.error("Critical Task Deletion Error:", error); 
        }
    }
}


// --- ì´ˆê¸°í™” ---

function initializeApp() {
    updateDateTime();
    renderTodoList(); 
    
    document.getElementById('addTaskBtn').addEventListener('click', addTask);
    // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í•­ëª© ì‚­ì œ í•¨ìˆ˜ë¡œ ì—°ê²°
    document.getElementById('resetManualBtn').addEventListener('click', resetTasksPermanently); 
    
    setInterval(updateDateTime, 1000); 
}

window.onload = initializeApp;

</script>

</body>
</html>